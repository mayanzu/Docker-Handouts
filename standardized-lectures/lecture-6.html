<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>第6课时 - MySQL主从复制</title>
  <link rel="stylesheet" href="../lecture-assets/css/lecture-template.css">
</head>
<body>
  <div class="lecture-page">
    <div class="page-container" id="pageContainer">

<div class="page cover-page">
        <div class="cover-content">
          <div class="course-badge">虚拟化容器技术</div>
          <h1 class="main-title">第6课时</h1>
          <h2 class="sub-title">MySQL主从复制</h2>
          <p class="tagline">Docker部署数据库高可用架构</p>
          <div class="meta-info">
            <span>📚 90分钟</span>
            <span>🎯 理论+实操</span>
            <span>📊 进阶级</span>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">01</span>
          <h1 class="page-title">课程目标</h1>
        </div>
        <div class="page-body">
          <div class="goal-list">
            <div class="goal-item">
              <div class="goal-icon">📚</div>
              <div class="goal-content">
                <h3>理解主从复制原理</h3>
                <p>Binlog日志与复制机制</p>
              </div>
            </div>
            <div class="goal-item">
              <div class="goal-icon">🔧</div>
              <div class="goal-content">
                <h3>掌握Docker部署MySQL</h3>
                <p>主从架构搭建</p>
              </div>
            </div>
            <div class="goal-item">
              <div class="goal-icon">✅</div>
              <div class="goal-content">
                <h3>验证数据同步</h3>
                <p>主从一致性测试</p>
              </div>
            </div>
            <div class="goal-item">
              <div class="goal-icon">🔄</div>
              <div class="goal-content">
                <h3>故障切换演练</h3>
                <p>主库故障处理</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">02</span>
          <h1 class="page-title">课程安排</h1>
        </div>
        <div class="page-body">
          <div class="schedule-grid">
            <div class="schedule-item">
              <div class="schedule-time">30分钟</div>
              <div class="schedule-type">理论讲解</div>
              <div class="schedule-desc">主从复制原理、架构设计</div>
            </div>
            <div class="schedule-item">
              <div class="schedule-time">40分钟</div>
              <div class="schedule-type">实操演示</div>
              <div class="schedule-desc">部署主从、验证同步</div>
            </div>
            <div class="schedule-item">
              <div class="schedule-time">20分钟</div>
              <div class="schedule-type">练习与总结</div>
              <div class="schedule-desc">故障切换、问题排查</div>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 1</span>
          <h1 class="section-title">主从复制原理</h1>
          <p class="section-desc">理解MySQL数据同步机制</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 1.1</span>
          <h1 class="page-title">什么是主从复制？</h1>
        </div>
        <div class="page-body">
          <div class="definition-box">
            <div class="definition-term">主从复制（Master-Slave Replication）</div>
            <div class="definition-content">
              将主数据库的数据实时同步到一个或多个从数据库，实现数据的冗余备份、读写分离和负载均衡。
            </div>
          </div>
          <div class="arch-diagram">
            <div class="arch-layer master">主库（Master）- 写操作</div>
            <div class="arch-arrow">↓ Binlog同步</div>
            <div class="arch-layer slave">从库（Slave）- 读操作</div>
          </div>
          <div class="term-box">
            <div class="term-title">📚 名词解释：读写分离</div>
            <p>写操作在主库执行，读操作分发到从库。可大幅提升系统读性能，适合读多写少的场景。</p>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 1.2</span>
          <h1 class="page-title">复制工作原理</h1>
        </div>
        <div class="page-body">
          <div class="install-step">
            <div class="step-number">Step 1</div>
            <div class="step-content">
              <h4>主库记录Binlog</h4>
              <p class="paragraph">主库将所有写操作记录到二进制日志（Binlog）</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number">Step 2</div>
            <div class="step-content">
              <h4>从库I/O线程</h4>
              <p class="paragraph">从库启动I/O线程，连接主库读取Binlog</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number">Step 3</div>
            <div class="step-content">
              <h4>写入Relay Log</h4>
              <p class="paragraph">从库将读取的Binlog写入中继日志（Relay Log）</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number">Step 4</div>
            <div class="step-content">
              <h4>SQL线程重放</h4>
              <p class="paragraph">SQL线程读取Relay Log，执行SQL语句</p>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 1.3</span>
          <h1 class="page-title">复制架构示意</h1>
        </div>
        <div class="page-body">
          <div class="arch-diagram vertical">
            <div class="arch-box master-box">
              <div class="box-title">Master 主库</div>
              <div class="box-content">
                <div class="box-item">Binlog日志</div>
                <div class="box-item">写操作</div>
              </div>
            </div>
            <div class="arch-flow">
              <span class="flow-text">I/O线程读取</span>
              <span class="flow-arrow">↓</span>
            </div>
            <div class="arch-box slave-box">
              <div class="box-title">Slave 从库</div>
              <div class="box-content">
                <div class="box-item">Relay Log</div>
                <div class="box-item">SQL线程重放</div>
              </div>
            </div>
          </div>
          <div class="highlight-box info">
            <div class="highlight-title">💡 关键点</div>
            <div class="highlight-content">
              <p>复制是异步的，从库数据可能略有延迟</p>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 1.4</span>
          <h1 class="page-title">应用场景</h1>
        </div>
        <div class="page-body">
          <div class="pain-points-grid">
            <div class="pain-point-card" style="border-color: #bbf7d0;">
              <div class="pain-icon">📖</div>
              <h3>读写分离</h3>
              <p>主库写，从库读</p>
              <p>提升读性能</p>
            </div>
            <div class="pain-point-card" style="border-color: #bbf7d0;">
              <div class="pain-icon">💾</div>
              <h3>数据备份</h3>
              <p>实时数据冗余</p>
              <p>防止数据丢失</p>
            </div>
            <div class="pain-point-card" style="border-color: #bbf7d0;">
              <div class="pain-icon">🔄</div>
              <h3>故障切换</h3>
              <p>主库故障时</p>
              <p>从库接管服务</p>
            </div>
            <div class="pain-point-card" style="border-color: #bbf7d0;">
              <div class="pain-icon">📊</div>
              <h3>数据分析</h3>
              <p>从库执行报表</p>
              <p>不影响主库</p>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 2</span>
          <h1 class="section-title">Docker部署MySQL主从</h1>
          <p class="section-desc">容器化数据库集群搭建</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 2.1</span>
          <h1 class="page-title">创建Docker网络</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">创建专用网络</span>
            </div>
            <pre><code># 创建bridge网络
docker network create mysql-net

# 查看网络
docker network ls</code></pre>
          </div>
          <div class="tip-box">
            <div class="tip-title">💡 为什么需要自定义网络？</div>
            <p>自定义网络支持容器名解析，主从容器可以通过容器名相互访问，无需知道具体IP。</p>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 2.2</span>
          <h1 class="page-title">部署主库（Master）</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">启动主库容器</span>
            </div>
            <pre><code>docker run -d \
  --name mysql-master \
  --network mysql-net \
  -p 3306:3306 \
  -e MYSQL_ROOT_PASSWORD=123456 \
  -v mysql-master-data:/var/lib/mysql \
  mysql:8.0</code></pre>
          </div>
          <div class="param-list">
            <div class="param-item">
              <span class="param-name">--network mysql-net</span>
              <span class="param-desc">加入自定义网络</span>
            </div>
            <div class="param-item">
              <span class="param-name">-v mysql-master-data</span>
              <span class="param-desc">数据持久化</span>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 2.3</span>
          <h1 class="page-title">配置主库参数</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">编辑my.cnf配置文件</span>
            </div>
            <pre><code># 进入容器
docker exec -it mysql-master bash

# 编辑配置
vim /etc/mysql/my.cnf

# 添加以下配置
[mysqld]
server-id = 1          # 服务器唯一ID
log-bin = mysql-bin    # 开启Binlog
binlog-format = ROW    # Binlog格式</code></pre>
          </div>
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">重启主库</span>
            </div>
            <pre><code>docker restart mysql-master</code></pre>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 2.4</span>
          <h1 class="page-title">创建复制用户</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">在主库创建复制账号</span>
            </div>
            <pre><code># 连接主库
docker exec -it mysql-master mysql -uroot -p123456

# 创建复制用户
CREATE USER 'repl'@'%' IDENTIFIED BY 'repl123';
GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%';
FLUSH PRIVILEGES;

# 查看主库状态
SHOW MASTER STATUS;</code></pre>
          </div>
          <div class="example-box">
            <div class="example-title">输出示例</div>
            <pre><code>+------------------+----------+--------------+------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |
+------------------+----------+--------------+------------------+
| mysql-bin.000001 |      156 |              |                  |
+------------------+----------+--------------+------------------+</code></pre>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 2.5</span>
          <h1 class="page-title">部署从库（Slave）</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">启动从库容器</span>
            </div>
            <pre><code>docker run -d \
  --name mysql-slave \
  --network mysql-net \
  -p 3307:3306 \
  -e MYSQL_ROOT_PASSWORD=123456 \
  -v mysql-slave-data:/var/lib/mysql \
  mysql:8.0</code></pre>
          </div>
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">配置从库参数</span>
            </div>
            <pre><code># 进入容器配置
docker exec -it mysql-slave bash
vim /etc/mysql/my.cnf

# 添加配置
[mysqld]
server-id = 2          # 服务器唯一ID（不能与主库相同）
relay-log = relay-bin  # 中继日志

# 重启从库
docker restart mysql-slave</code></pre>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 2.6</span>
          <h1 class="page-title">配置从库复制</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">连接从库并配置</span>
            </div>
            <pre><code># 连接从库
docker exec -it mysql-slave mysql -uroot -p123456

# 配置主库信息
CHANGE MASTER TO
  MASTER_HOST='mysql-master',
  MASTER_USER='repl',
  MASTER_PASSWORD='repl123',
  MASTER_LOG_FILE='mysql-bin.000001',
  MASTER_LOG_POS=156;

# 启动复制
START SLAVE;

# 查看从库状态
SHOW SLAVE STATUS\G</code></pre>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 2.7</span>
          <h1 class="page-title">验证复制状态</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">查看从库状态</span>
            </div>
            <pre><code>SHOW SLAVE STATUS\G</code></pre>
          </div>
          <div class="highlight-box success">
            <div class="highlight-title">✅ 成功标志</div>
            <div class="highlight-content">
              <p><strong>Slave_IO_Running: Yes</strong></p>
              <p><strong>Slave_SQL_Running: Yes</strong></p>
              <p>两个线程都为Yes表示复制正常</p>
            </div>
          </div>
          <div class="warning-box">
            <div class="warning-title">⚠️ 常见错误</div>
            <p>Slave_IO_Running: Connecting - 网络或认证问题</p>
            <p>Slave_SQL_Running: No - SQL执行错误</p>
          </div>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 3</span>
          <h1 class="section-title">数据同步验证</h1>
          <p class="section-desc">测试主从复制功能</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 3.1</span>
          <h1 class="page-title">测试数据同步</h1>
        </div>
        <div class="page-body">
          <div class="install-step">
            <div class="step-number">Step 1</div>
            <div class="step-content">
              <h4>在主库创建数据</h4>
              <div class="code-block">
                <pre><code>docker exec -it mysql-master mysql -uroot -p123456

CREATE DATABASE testdb;
USE testdb;
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(50)
);
INSERT INTO users (name) VALUES ('张三'), ('李四');</code></pre>
              </div>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number">Step 2</div>
            <div class="step-content">
              <h4>在从库查询数据</h4>
              <div class="code-block">
                <pre><code>docker exec -it mysql-slave mysql -uroot -p123456

SELECT * FROM testdb.users;</code></pre>
              </div>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 3.2</span>
          <h1 class="page-title">验证结果</h1>
        </div>
        <div class="page-body">
          <div class="example-box">
            <div class="example-title">从库查询结果</div>
            <pre><code>+----+--------+
| id | name   |
+----+--------+
|  1 | 张三   |
|  2 | 李四   |
+----+--------+</code></pre>
          </div>
          <div class="highlight-box success">
            <div class="highlight-title">✅ 验证成功</div>
            <div class="highlight-content">
              <p>从库能够查询到主库写入的数据，说明主从复制工作正常。</p>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 4</span>
          <h1 class="section-title">故障切换演练</h1>
          <p class="section-desc">主库故障处理</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 4.1</span>
          <h1 class="page-title">模拟主库故障</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">停止主库</span>
            </div>
            <pre><code># 停止主库容器
docker stop mysql-master

# 验证主库已停止
docker ps | grep mysql-master</code></pre>
          </div>
          <div class="warning-box">
            <div class="warning-title">⚠️ 注意</div>
            <p>此时应用无法写入数据，需要将从库提升为主库。</p>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 4.2</span>
          <h1 class="page-title">从库提升为主库</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">将从库提升为主库</span>
            </div>
            <pre><code># 连接从库
docker exec -it mysql-slave mysql -uroot -p123456

# 停止复制
STOP SLAVE;

# 重置为主库
RESET MASTER;

# 此时从库变为独立主库
# 应用可以连接此库进行读写</code></pre>
          </div>
          <div class="tip-box">
            <div class="tip-title">💡 生产环境建议</div>
            <p>使用MHA、Orchestrator等工具实现自动故障切换。</p>
          </div>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 5</span>
          <h1 class="section-title">随堂练习</h1>
          <p class="section-desc">巩固所学知识</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 5</span>
          <h1 class="page-title">随堂练习</h1>
        </div>
        <div class="page-body">
          <div class="exercise-tasks">
            <div class="exercise-task">
              <div class="task-number">1</div>
              <div class="task-content">
                <h3>搭建主从架构</h3>
                <p>使用Docker部署MySQL主从复制</p>
              </div>
            </div>
            <div class="exercise-task">
              <div class="task-number">2</div>
              <div class="task-content">
                <h3>验证数据同步</h3>
                <p>主库插入数据，从库查询验证</p>
              </div>
            </div>
            <div class="exercise-task">
              <div class="task-number">3</div>
              <div class="task-content">
                <h3>测试故障切换</h3>
                <p>停止主库，将从库提升为主库</p>
              </div>
            </div>
            <div class="exercise-task">
              <div class="task-number">4</div>
              <div class="task-content">
                <h3>提交截图</h3>
                <p>SHOW SLAVE STATUS输出结果</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">总结</span>
          <h1 class="page-title">本课时小结</h1>
        </div>
        <div class="page-body">
          <div class="summary-grid">
            <div class="summary-item">
              <div class="summary-icon">✅</div>
              <div class="summary-text">主从复制原理：Binlog、I/O线程、SQL线程</div>
            </div>
            <div class="summary-item">
              <div class="summary-icon">✅</div>
              <div class="summary-text">Docker部署：网络、主库、从库配置</div>
            </div>
            <div class="summary-item">
              <div class="summary-icon">✅</div>
              <div class="summary-text">数据同步验证：主库写入、从库读取</div>
            </div>
            <div class="summary-item">
              <div class="summary-icon">✅</div>
              <div class="summary-text">故障切换：从库提升为主库</div>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">预告</span>
          <h1 class="page-title">下节预告</h1>
        </div>
        <div class="page-body">
          <div class="next-lecture">
            <h3>📚 第7课时：Redis集群搭建</h3>
            <ul>
              <li>Redis主从复制</li>
              <li>哨兵模式高可用</li>
              <li>Cluster集群部署</li>
              <li>缓存应用实践</li>
            </ul>
          </div>
        </div>
      </div>

    </div>

    <div class="page-navigation">
      <button class="nav-btn prev" id="prevBtn">上一页</button>
      <div class="page-indicator">
        <span class="current" id="currentPage">1</span>
        <span class="separator">/</span>
        <span class="total" id="totalPages">22</span>
      </div>
      <button class="nav-btn next" id="nextBtn">下一页</button>
    </div>

  </div>

  <script src="../lecture-assets/js/lecture-template.js"></script>
</body>
</html>
