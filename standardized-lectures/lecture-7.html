<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>第7课时 - Redis集群搭建</title>
  <link rel="stylesheet" href="../lecture-assets/css/lecture-template.css">
</head>
<body>
  <div class="lecture-page">
    <div class="page-container" id="pageContainer">

<div class="page cover-page">
        <div class="cover-content">
          <div class="course-badge">虚拟化容器技术</div>
          <h1 class="main-title">第7课时</h1>
          <h2 class="sub-title">Redis集群搭建</h2>
          <p class="tagline">主从复制、哨兵模式与Cluster集群</p>
          <div class="meta-info">
            <span>📚 90分钟</span>
            <span>🎯 理论+实操</span>
            <span>📊 进阶级</span>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">01</span>
          <h1 class="page-title">课程目标</h1>
        </div>
        <div class="page-body">
          <div class="goal-list">
            <div class="goal-item">
              <div class="goal-icon">📚</div>
              <div class="goal-content">
                <h3>理解Redis主从复制</h3>
                <p>数据同步机制</p>
              </div>
            </div>
            <div class="goal-item">
              <div class="goal-icon">🛡️</div>
              <div class="goal-content">
                <h3>掌握哨兵模式</h3>
                <p>高可用自动切换</p>
              </div>
            </div>
            <div class="goal-item">
              <div class="goal-icon">🔗</div>
              <div class="goal-content">
                <h3>部署Cluster集群</h3>
                <p>分布式存储方案</p>
              </div>
            </div>
            <div class="goal-item">
              <div class="goal-icon">⚡</div>
              <div class="goal-content">
                <h3>缓存应用实践</h3>
                <p>缓存穿透与雪崩</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">02</span>
          <h1 class="page-title">课程安排</h1>
        </div>
        <div class="page-body">
          <div class="schedule-grid">
            <div class="schedule-item">
              <div class="schedule-time">30分钟</div>
              <div class="schedule-type">理论讲解</div>
              <div class="schedule-desc">Redis架构模式对比</div>
            </div>
            <div class="schedule-item">
              <div class="schedule-time">45分钟</div>
              <div class="schedule-type">实操演示</div>
              <div class="schedule-desc">主从、哨兵、Cluster部署</div>
            </div>
            <div class="schedule-item">
              <div class="schedule-time">15分钟</div>
              <div class="schedule-type">练习与总结</div>
              <div class="schedule-desc">缓存应用实践</div>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 1</span>
          <h1 class="section-title">Redis架构模式</h1>
          <p class="section-desc">三种部署模式对比</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 1.1</span>
          <h1 class="page-title">Redis简介</h1>
        </div>
        <div class="page-body">
          <div class="definition-box">
            <div class="definition-term">Redis</div>
            <div class="definition-content">
              Redis是一个开源的内存数据结构存储系统，可用作数据库、缓存和消息中间件。支持多种数据结构：字符串、哈希、列表、集合、有序集合等。
            </div>
          </div>
          <div class="term-box">
            <div class="term-title">📚 名词解释：内存数据库</div>
            <p>数据存储在内存中，读写速度极快（微秒级）。通过持久化机制（RDB/AOF）将内存数据保存到磁盘，防止数据丢失。</p>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 1.2</span>
          <h1 class="page-title">三种架构模式对比</h1>
        </div>
        <div class="page-body">
          <table class="compare-table full-width">
            <thead>
              <tr>
                <th>模式</th>
                <th>特点</th>
                <th>适用场景</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>主从复制</strong></td>
                <td>一主多从，读写分离</td>
                <td>读多写少，数据备份</td>
              </tr>
              <tr>
                <td><strong>哨兵模式</strong></td>
                <td>自动故障转移</td>
                <td>高可用要求</td>
              </tr>
              <tr>
                <td><strong>Cluster集群</strong></td>
                <td>分布式存储，数据分片</td>
                <td>大数据量，高并发</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 2</span>
          <h1 class="section-title">Redis主从复制</h1>
          <p class="section-desc">一主多从架构搭建</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 2.1</span>
          <h1 class="page-title">主从复制原理</h1>
        </div>
        <div class="page-body">
          <div class="install-step">
            <div class="step-number">Step 1</div>
            <div class="step-content">
              <h4>建立连接</h4>
              <p class="paragraph">从库连接主库，发送SYNC命令</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number">Step 2</div>
            <div class="step-content">
              <h4>RDB快照</h4>
              <p class="paragraph">主库执行bgsave，生成RDB文件</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number">Step 3</div>
            <div class="step-content">
              <h4>传输数据</h4>
              <p class="paragraph">主库将RDB文件发送给从库</p>
            </div>
          </div>
          <div class="install-step">
            <div class="step-number">Step 4</div>
            <div class="step-content">
              <h4>增量同步</h4>
              <p class="paragraph">主库将新写命令发送给从库</p>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 2.2</span>
          <h1 class="page-title">Docker部署主从</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">启动主库</span>
            </div>
            <pre><code>docker run -d --name redis-master \
  -p 6379:6379 \
  redis:7-alpine</code></pre>
          </div>
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">启动从库</span>
            </div>
            <pre><code>docker run -d --name redis-slave \
  -p 6380:6379 \
  redis:7-alpine \
  redis-server --slaveof redis-master 6379</code></pre>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 2.3</span>
          <h1 class="page-title">验证主从复制</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">查看复制状态</span>
            </div>
            <pre><code># 连接主库
docker exec -it redis-master redis-cli

# 查看主库信息
127.0.0.1:6379> INFO replication
role:master
connected_slaves:1

# 连接从库
docker exec -it redis-slave redis-cli

# 查看从库信息
127.0.0.1:6379> INFO replication
role:slave
master_host:redis-master</code></pre>
          </div>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 3</span>
          <h1 class="section-title">哨兵模式</h1>
          <p class="section-desc">自动故障转移</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 3.1</span>
          <h1 class="page-title">什么是哨兵模式？</h1>
        </div>
        <div class="page-body">
          <div class="definition-box">
            <div class="definition-term">哨兵（Sentinel）</div>
            <div class="definition-content">
              Redis Sentinel是Redis官方提供的高可用解决方案，用于监控主从节点、自动故障转移和配置提供者。
            </div>
          </div>
          <div class="pain-points-grid">
            <div class="pain-point-card" style="border-color: #bbf7d0;">
              <div class="pain-icon">👁️</div>
              <h3>监控</h3>
              <p>检查主从节点是否正常</p>
            </div>
            <div class="pain-point-card" style="border-color: #bbf7d0;">
              <div class="pain-icon">🔄</div>
              <h3>故障转移</h3>
              <p>主库故障时自动切换</p>
            </div>
            <div class="pain-point-card" style="border-color: #bbf7d0;">
              <div class="pain-icon">📢</div>
              <h3>通知</h3>
              <p>通知客户端新的主库地址</p>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 3.2</span>
          <h1 class="page-title">哨兵配置文件</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">sentinel.conf</span>
            </div>
            <pre><code># 监控主节点
sentinel monitor mymaster 192.168.1.100 6379 2

# 主节点多久无响应认为下线
sentinel down-after-milliseconds mymaster 30000

# 故障转移超时时间
sentinel failover-timeout mymaster 180000

# 同时可以有多少从节点对新主节点同步
sentinel parallel-syncs mymaster 1</code></pre>
          </div>
          <div class="param-list">
            <div class="param-item">
              <span class="param-name">mymaster</span>
              <span class="param-desc">主节点名称</span>
            </div>
            <div class="param-item">
              <span class="param-name">2</span>
              <span class="param-desc">需要2个哨兵同意才能故障转移</span>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 3.3</span>
          <h1 class="page-title">Docker部署哨兵</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">启动哨兵容器</span>
            </div>
            <pre><code># 创建配置目录
mkdir -p /data/redis-sentinel

# 创建配置文件
cat > /data/redis-sentinel/sentinel.conf << EOF
sentinel monitor mymaster redis-master 6379 2
sentinel down-after-milliseconds mymaster 30000
sentinel parallel-syncs mymaster 1
sentinel failover-timeout mymaster 180000
EOF

# 启动哨兵
docker run -d --name redis-sentinel \
  --network redis-net \
  -v /data/redis-sentinel:/data \
  redis:7-alpine \
  redis-sentinel /data/sentinel.conf</code></pre>
          </div>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 4</span>
          <h1 class="section-title">Cluster集群</h1>
          <p class="section-desc">分布式存储方案</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 4.1</span>
          <h1 class="page-title">Redis Cluster简介</h1>
        </div>
        <div class="page-body">
          <div class="definition-box">
            <div class="definition-term">Redis Cluster</div>
            <div class="definition-content">
              Redis官方提供的分布式解决方案，支持数据自动分片、自动故障转移，可线性扩展到1000个节点。
            </div>
          </div>
          <div class="term-box">
            <div class="term-title">📚 名词解释：数据分片</div>
            <p>将数据分散存储在多个节点上。Redis Cluster使用哈希槽（Slot）实现，共16384个槽位，每个节点负责一部分槽位。</p>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 4.2</span>
          <h1 class="page-title">Cluster架构特点</h1>
        </div>
        <div class="page-body">
          <div class="feature-list">
            <div class="feature-item">
              <span class="feature-icon">✓</span>
              <span>最少6个节点：3主3从</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">✓</span>
              <span>数据分片：16384个哈希槽</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">✓</span>
              <span>去中心化：无代理节点</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">✓</span>
              <span>自动故障转移</span>
            </div>
          </div>
          <div class="arch-diagram">
            <div class="arch-layer cluster">Master1 (0-5460槽)</div>
            <div class="arch-layer cluster">Master2 (5461-10922槽)</div>
            <div class="arch-layer cluster">Master3 (10923-16383槽)</div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 4.3</span>
          <h1 class="page-title">Docker部署Cluster</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">创建网络</span>
            </div>
            <pre><code>docker network create redis-cluster</code></pre>
          </div>
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">启动6个Redis节点</span>
            </div>
            <pre><code>for i in $(seq 1 6); do
  docker run -d --name redis-$i \
    --network redis-cluster \
    -p 700$i:6379 \
    redis:7-alpine \
    redis-server --cluster-enabled yes
done</code></pre>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 4.4</span>
          <h1 class="page-title">创建集群</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">初始化集群</span>
            </div>
            <pre><code># 进入任意节点
docker exec -it redis-1 redis-cli --cluster create \
  redis-1:6379 redis-2:6379 redis-3:6379 \
  redis-4:6379 redis-5:6379 redis-6:6379 \
  --cluster-replicas 1

# 输入yes确认
# 集群创建成功</code></pre>
          </div>
          <div class="highlight-box success">
            <div class="highlight-title">✅ 集群创建成功</div>
            <div class="highlight-content">
              <p>3主3从架构，每个主节点有一个从节点</p>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 4.5</span>
          <h1 class="page-title">验证集群状态</h1>
        </div>
        <div class="page-body">
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">查看集群信息</span>
            </div>
            <pre><code># 连接集群
docker exec -it redis-1 redis-cli -c

# 查看集群状态
127.0.0.1:6379> CLUSTER INFO
cluster_state:ok
cluster_slots_assigned:16384
cluster_known_nodes:6

# 查看节点信息
127.0.0.1:6379> CLUSTER NODES</code></pre>
          </div>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 5</span>
          <h1 class="section-title">缓存应用实践</h1>
          <p class="section-desc">常见问题与解决方案</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 5.1</span>
          <h1 class="page-title">缓存穿透</h1>
        </div>
        <div class="page-body">
          <div class="definition-box">
            <div class="definition-term">缓存穿透</div>
            <div class="definition-content">
              查询不存在的数据，缓存和数据库都没有，每次请求都穿透到数据库。
            </div>
          </div>
          <div class="pain-points-grid">
            <div class="pain-point-card" style="border-color: #fca5a5;">
              <div class="pain-icon">💥</div>
              <h3>问题</h3>
              <p>恶意请求大量不存在的key</p>
            </div>
            <div class="pain-point-card" style="border-color: #bbf7d0;">
              <div class="pain-icon">✅</div>
              <h3>解决方案</h3>
              <p>布隆过滤器、缓存空值</p>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 5.2</span>
          <h1 class="page-title">缓存雪崩</h1>
        </div>
        <div class="page-body">
          <div class="definition-box">
            <div class="definition-term">缓存雪崩</div>
            <div class="definition-content">
              大量缓存同时过期，所有请求都打到数据库，导致数据库压力过大甚至崩溃。
            </div>
          </div>
          <div class="pain-points-grid">
            <div class="pain-point-card" style="border-color: #fca5a5;">
              <div class="pain-icon">💥</div>
              <h3>问题</h3>
              <p>缓存集中过期</p>
            </div>
            <div class="pain-point-card" style="border-color: #bbf7d0;">
              <div class="pain-icon">✅</div>
              <h3>解决方案</h3>
              <p>随机过期时间、多级缓存</p>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 5.3</span>
          <h1 class="page-title">缓存击穿</h1>
        </div>
        <div class="page-body">
          <div class="definition-box">
            <div class="definition-term">缓存击穿</div>
            <div class="definition-content">
              热点key过期，大量请求同时访问这个key，全部打到数据库。
            </div>
          </div>
          <div class="pain-points-grid">
            <div class="pain-point-card" style="border-color: #fca5a5;">
              <div class="pain-icon">💥</div>
              <h3>问题</h3>
              <p>热点key过期瞬间</p>
            </div>
            <div class="pain-point-card" style="border-color: #bbf7d0;">
              <div class="pain-icon">✅</div>
              <h3>解决方案</h3>
              <p>互斥锁、永不过期</p>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page section-page">
        <div class="section-content">
          <span class="section-label">Part 6</span>
          <h1 class="section-title">随堂练习</h1>
          <p class="section-desc">巩固所学知识</p>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">Part 6</span>
          <h1 class="page-title">随堂练习</h1>
        </div>
        <div class="page-body">
          <div class="exercise-tasks">
            <div class="exercise-task">
              <div class="task-number">1</div>
              <div class="task-content">
                <h3>部署主从复制</h3>
                <p>一主一从架构</p>
              </div>
            </div>
            <div class="exercise-task">
              <div class="task-number">2</div>
              <div class="task-content">
                <h3>验证数据同步</h3>
                <p>主库写入，从库读取</p>
              </div>
            </div>
            <div class="exercise-task">
              <div class="task-number">3</div>
              <div class="task-content">
                <h3>部署Cluster集群</h3>
                <p>3主3从架构</p>
              </div>
            </div>
            <div class="exercise-task">
              <div class="task-number">4</div>
              <div class="task-content">
                <h3>提交截图</h3>
                <p>CLUSTER INFO输出结果</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">总结</span>
          <h1 class="page-title">本课时小结</h1>
        </div>
        <div class="page-body">
          <div class="summary-grid">
            <div class="summary-item">
              <div class="summary-icon">✅</div>
              <div class="summary-text">主从复制：一主多从，读写分离</div>
            </div>
            <div class="summary-item">
              <div class="summary-icon">✅</div>
              <div class="summary-text">哨兵模式：自动监控与故障转移</div>
            </div>
            <div class="summary-item">
              <div class="summary-icon">✅</div>
              <div class="summary-text">Cluster集群：分布式存储，数据分片</div>
            </div>
            <div class="summary-item">
              <div class="summary-icon">✅</div>
              <div class="summary-text">缓存问题：穿透、雪崩、击穿</div>
            </div>
          </div>
        </div>
      </div>

      
      <div class="page content-page">
        <div class="page-header">
          <span class="page-number">预告</span>
          <h1 class="page-title">下节预告</h1>
        </div>
        <div class="page-body">
          <div class="next-lecture">
            <h3>📚 第8课时：Docker网络原理</h3>
            <ul>
              <li>Docker网络类型</li>
              <li>Bridge网络原理</li>
              <li>Overlay网络</li>
              <li>容器间通信</li>
            </ul>
          </div>
        </div>
      </div>

    </div>

    <div class="page-navigation">
      <button class="nav-btn prev" id="prevBtn">上一页</button>
      <div class="page-indicator">
        <span class="current" id="currentPage">1</span>
        <span class="separator">/</span>
        <span class="total" id="totalPages">22</span>
      </div>
      <button class="nav-btn next" id="nextBtn">下一页</button>
    </div>

  </div>

  <script src="../lecture-assets/js/lecture-template.js"></script>
</body>
</html>
