<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第3讲:Dockerfile 自动化构建镜像</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles/common.css">
</head>
<body class="has-page-toc">

    <!-- Page TOC Navigation -->
    <nav class="page-toc">
        <div class="page-toc-title">本讲目录</div>
        <ul class="page-toc-list">
            <li><a href="#review" class="page-toc-link">1. 知识回顾:Docker 基础</a></li>
            <li><a href="#dockerfile-intro" class="page-toc-link">2. 认识 Dockerfile</a></li>
            <li><a href="#first-dockerfile" class="page-toc-link">3. 实战:动手写第一个 Dockerfile</a></li>
            <li><a href="#build-details" class="page-toc-link">4. docker build 命令详解</a></li>
            <li><a href="#dockerfile-commands" class="page-toc-link">5. Dockerfile 常用指令实战</a></li>
            <li><a href="#mini-project" class="page-toc-link">6. 完整项目实战:打包个人主页</a></li>
            <li><a href="#image-optimize" class="page-toc-link">7. 镜像优化技巧</a></li>
            <li><a href="#troubleshooting" class="page-toc-link">8. 常见错误排查</a></li>
        </ul>
    </nav>

    <!-- Header -->
    <header style="background-color: var(--color-text); color: white; padding: 2rem 0; border-bottom: 1px solid var(--color-border);">
        <div class="container">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                <i class="fab fa-docker" style="font-size: 2rem; color: var(--color-accent);"></i>
                <div>
                    <h1 style="color: white; font-size: 1.25rem; margin: 0;">Docker 容器技术竞赛培训</h1>
                    <p style="color: #e5e7eb; font-size: 0.875rem; margin: 0.25rem 0 0 0;">第三讲：Dockerfile 自动化构建镜像</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container" style="padding: 2rem 0 3rem 0;">

        <!-- Section 1: 知识回顾 -->
        <section id="review" class="section-card">
            <h2>
                <i class="fas fa-history" style="color: var(--color-accent); margin-right: 0.75rem;"></i>
                1. 知识回顾：Docker 基础
            </h2>

            <div class="module-concept">
                <div class="module-header">
                    <i class="fas fa-cube"></i>
                    <h4>三大核心概念</h4>
                </div>
                <div class="module-content">
                    <ul>
                        <li><strong>镜像（Image）：</strong>类似"软件安装包"，包含运行环境和程序</li>
                        <li><strong>容器（Container）：</strong>镜像运行后的实例，像"正在运行的软件"</li>
                        <li><strong>仓库（Registry）：</strong>存放镜像的云端仓库（如Docker Hub）</li>
                    </ul>
                </div>
            </div>

            <div class="module-steps" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-check-circle"></i>
                    <h4>验证命令回顾</h4>
                </div>
                <div class="module-content">
                    <div class="step-item">
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <h5>查看所有本地镜像</h5>
                            <div class="module-command">
                                <div class="module-content">
                                    <pre><code>docker images</code></pre>
                                </div>
                            </div>
                            <div class="module-output" style="margin-top: 0.5rem;">
                                <div class="module-content">
                                    <pre><code>REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
nginx        latest    605c77e624dd   2 weeks ago    141MB
nginx        alpine    8e75cbc5b25c   2 weeks ago    41MB</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-item">
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <h5>查看正在运行的容器</h5>
                            <div class="module-command">
                                <div class="module-content">
                                    <pre><code>docker ps</code></pre>
                                </div>
                            </div>
                            <div class="module-output" style="margin-top: 0.5rem;">
                                <div class="module-content">
                                    <pre><code>CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS
a1b2c3d4e5f6   nginx     "/docker-entrypoint.…"   2 minutes ago   Up 2 minutes</code></pre>
                                </div>
                            </div>
                            <div class="module-tip" style="margin-top: 0.5rem;">
                                <div class="module-content">
                                    <p><strong>💡 提示：</strong>如果没有输出，说明当前没有运行中的容器，这是正常的。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-tip" style="margin-top: 1.5rem;">
                <div class="module-content">
                    <p><strong>🤔 互动提问（请同学举手回答）：</strong></p>
                    <ul>
                        <li>如果 `docker ps` 什么都不显示，说明什么？</li>
                        <li>镜像和容器的关系，像什么和什么的关系？（提示：软件安装包和运行中的软件）</li>
                        <li>第二讲中我们用 `docker run -p 8080:80 nginx` 做了什么？</li>
                    </ul>
                </div>
            </div>

            <div class="module-note" style="margin-top: 1.5rem;">
                <div class="module-content">
                    <p><strong>💡 引出本讲核心：</strong>上节课我们手动进入容器修改文件，但每次重启容器改动就丢失了。有没有办法把修改"固化"到镜像里？<strong>Dockerfile</strong> 就是答案！它能让我们像写脚本一样，自动化构建镜像。</p>
                </div>
            </div>

            <div class="module-tip" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-lightbulb"></i>
                    <h4>引出本讲核心</h4>
                </div>
                <div class="module-content">
                    <p>上节课我们手动进入容器修改文件，但每次重启容器改动就丢失了。有没有办法把修改"固化"到镜像里？<strong>Dockerfile</strong> 就是答案！它能让我们像写脚本一样，自动化构建镜像。</p>
                </div>
            </div>
        </section>

        <!-- Section 2: 认识 Dockerfile -->
        <section id="dockerfile-intro" class="section-card">
            <h2>
                <i class="fas fa-file-code" style="color: var(--color-warning); margin-right: 0.75rem;"></i>
                2. 认识 Dockerfile：镜像的"施工图纸"
            </h2>

            <div class="module-concept">
                <div class="module-header">
                    <i class="fas fa-magic"></i>
                    <h4>为什么需要 Dockerfile？</h4>
                </div>
                <div class="module-content">
                    <div class="grid-auto">
                        <div style="background-color: #fee2e2; padding: 1rem; border-radius: 6px; border-left: 3px solid var(--color-error);">
                            <h5 style="color: var(--color-error); margin-bottom: 0.5rem;">❌ 手动做镜像的问题</h5>
                            <ul style="font-size: 0.875rem;">
                                <li>每次都要敲一遍命令</li>
                                <li>容易遗漏步骤或打错</li>
                                <li>无法记录修改历史</li>
                                <li>难以分享给别人复现</li>
                            </ul>
                        </div>
                        <div style="background-color: #dcfce7; padding: 1rem; border-radius: 6px; border-left: 3px solid var(--color-success);">
                            <h5 style="color: var(--color-success); margin-bottom: 0.5rem;">✅ Dockerfile 的优势</h5>
                            <ul style="font-size: 0.875rem;">
                                <li>一次编写，自动化构建</li>
                                <li>每一步都有文档记录</li>
                                <li>可以版本管理（git）</li>
                                <li>团队协作，完全一致</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-tip" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-sitemap"></i>
                    <h4>Dockerfile 就像搭积木</h4>
                </div>
                <div class="module-content">
                    <p style="margin-bottom: 0.75rem;">每一条指令都是在上一层基础上"叠加"一层新内容：</p>
                    <div class="module-command">
                        <div class="module-content">
                            <pre><code>基础镜像 (FROM)
    ↓
安装软件 (RUN)
    ↓
复制文件 (COPY)
    ↓
设置启动命令 (CMD)
    ↓
最终镜像</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: 第一个 Dockerfile -->
        <section id="first-dockerfile" class="section-card">
            <h2>
                <i class="fas fa-play-circle" style="color: var(--color-success); margin-right: 0.75rem;"></i>
                3. 实战：动手写第一个 Dockerfile
            </h2>

            <div class="module-steps">
                <div class="module-header">
                    <i class="fas fa-list-ol"></i>
                    <h4>完整操作步骤</h4>
                </div>
                <div class="module-content">
                    
                    <!-- 步骤1 -->
                    <div class="step-item">
                        <span class="step-number" style="background-color: var(--color-accent);">1</span>
                        <div class="step-content">
                            <h5>创建工作目录</h5>
                            <p style="margin-bottom: 0.5rem;">先创建一个文件夹，用来存放我们的 Dockerfile：</p>
                            <div class="module-command">
                                <div class="module-content">
                                    <pre><code>mkdir ~/my-first-dockerfile
cd ~/my-first-dockerfile</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 步骤2 -->
                    <div class="step-item">
                        <span class="step-number" style="background-color: var(--color-success);">2</span>
                        <div class="step-content">
                            <h5>创建并编辑 Dockerfile</h5>
                            <p style="margin-bottom: 0.5rem;">用文本编辑器创建一个名为 <code>Dockerfile</code> 的文件（注意：没有扩展名）：</p>
                            <div class="module-command">
                                <div class="module-content">
                                    <pre><code>nano Dockerfile</code></pre>
                                </div>
                            </div>
                            
                            <div class="module-code-file" style="margin-top: 1rem;">
                                <div class="module-header">
                                    <i class="fas fa-file-code"></i>
                                    <h4>Dockerfile 内容</h4>
                                </div>
                                <div class="module-content">
                                    <pre><code># 使用官方 nginx 镜像作为基础
FROM nginx:alpine

# 创建一个简单的 HTML 文件
RUN echo '&lt;h1&gt;Hello from Dockerfile!&lt;/h1&gt;' > /usr/share/nginx/html/index.html

# 容器启动时运行 nginx
CMD ["nginx", "-g", "daemon off;"]</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 步骤3 -->
                    <div class="step-item">
                        <span class="step-number" style="background-color: var(--color-warning);">3</span>
                        <div class="step-content">
                            <h5>理解每一行指令</h5>
                            <ul style="font-size: 0.875rem;">
                                <li><code style="color: var(--color-accent);">FROM nginx:alpine</code> - 选择 nginx:alpine 作为"起点"，alpine 是精简版</li>
                                <li><code style="color: var(--color-success);">RUN echo '...'</code> - 在构建过程中执行命令，创建新的首页文件</li>
                                <li><code style="color: var(--color-warning);">CMD ["nginx", ...]</code> - 容器启动时要运行的命令</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 步骤4 -->
                    <div class="step-item">
                        <span class="step-number" style="background-color: var(--color-error);">4</span>
                        <div class="step-content">
                            <h5>构建镜像（关键步骤！）</h5>
                            <div class="module-command">
                                <div class="module-content">
                                    <pre><code>docker build -t my-nginx:v1 .</code></pre>
                                </div>
                            </div>
                            <p style="margin-top: 0.5rem; font-size: 0.875rem;"><strong>命令解析：</strong></p>
                            <ul style="font-size: 0.875rem;">
                                <li><code>docker build</code> - 构建镜像的命令</li>
                                <li><code>-t my-nginx:v1</code> - 给镜像起名字和标签</li>
                                <li><code>.</code> - 点号表示当前目录</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 步骤5 -->
                    <div class="step-item">
                        <span class="step-number">5</span>
                        <div class="step-content">
                            <h5>运行容器测试</h5>
                            <div class="module-command">
                                <div class="module-content">
                                    <pre><code>docker run -d -p 8080:80 --name test-nginx my-nginx:v1</code></pre>
                                </div>
                            </div>
                            <p style="margin-top: 0.5rem; font-size: 0.875rem;">访问 <code>http://localhost:8080</code>，应该看到 "Hello from Dockerfile!"</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: docker build 详解 -->
        <section id="build-details" class="section-card">
            <h2>
                <i class="fas fa-cog" style="color: var(--color-accent); margin-right: 0.75rem;"></i>
                4. docker build 命令详解
            </h2>

            <div class="module-concept">
                <div class="module-header">
                    <i class="fas fa-terminal"></i>
                    <h4>常用构建参数</h4>
                </div>
                <div class="module-content">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--color-border);">
                                <th style="text-align: left; padding: 0.75rem; font-weight: 600;">参数</th>
                                <th style="text-align: left; padding: 0.75rem; font-weight: 600;">说明</th>
                                <th style="text-align: left; padding: 0.75rem; font-weight: 600;">示例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid var(--color-border);">
                                <td style="padding: 0.75rem;"><code>-t</code></td>
                                <td style="padding: 0.75rem;">指定镜像名称和标签</td>
                                <td style="padding: 0.75rem;"><code>-t myapp:v1</code></td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--color-border);">
                                <td style="padding: 0.75rem;"><code>-f</code></td>
                                <td style="padding: 0.75rem;">指定 Dockerfile 文件名</td>
                                <td style="padding: 0.75rem;"><code>-f Dockerfile.prod</code></td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--color-border);">
                                <td style="padding: 0.75rem;"><code>--no-cache</code></td>
                                <td style="padding: 0.75rem;">不使用缓存，强制重新构建</td>
                                <td style="padding: 0.75rem;"><code>--no-cache</code></td>
                            </tr>
                            <tr>
                                <td style="padding: 0.75rem;"><code>.</code></td>
                                <td style="padding: 0.75rem;">构建上下文（当前目录）</td>
                                <td style="padding: 0.75rem;"><code>.</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="module-tip" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-lightbulb"></i>
                    <h4>什么是"构建上下文"？</h4>
                </div>
                <div class="module-content">
                    <p>构建上下文是指 <code>docker build</code> 命令最后指定的路径（通常是 <code>.</code>）。Docker 会把这个目录下的所有文件打包发送给 Docker 守护进程，所以 <code>COPY</code> 指令只能访问这个目录下的文件。</p>
                </div>
            </div>
        </section>

        <!-- Section 5: 常用指令实战 -->
        <section id="dockerfile-commands" class="section-card">
            <h2>
                <i class="fas fa-code" style="color: var(--color-accent); margin-right: 0.75rem;"></i>
                5. Dockerfile 常用指令实战
            </h2>

            <!-- FROM -->
            <div class="module-concept">
                <div class="module-header">
                    <i class="fas fa-layer-group"></i>
                    <h4>FROM：指定基础镜像</h4>
                </div>
                <div class="module-content">
                    <p>每个 Dockerfile 必须以 FROM 开头，指定从哪个镜像开始构建。</p>
                    <div class="module-code-file" style="margin-top: 0.75rem;">
                        <div class="module-content">
                            <pre><code># 使用官方镜像
FROM nginx:alpine

# 使用特定版本
FROM python:3.9

# 从零开始（很少用）
FROM scratch</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RUN -->
            <div class="module-concept" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-terminal"></i>
                    <h4>RUN：执行命令</h4>
                </div>
                <div class="module-content">
                    <p>在镜像构建时执行命令，常用于安装软件、创建文件等。</p>
                    <div class="module-code-file" style="margin-top: 0.75rem;">
                        <div class="module-content">
                            <pre><code>FROM ubuntu:20.04

# 单条命令
RUN apt-get update

# 多条命令用 && 连接（推荐）
RUN apt-get update && apt-get install -y nginx curl</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COPY & ADD -->
            <div class="module-concept" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-copy"></i>
                    <h4>COPY & ADD：复制文件</h4>
                </div>
                <div class="module-content">
                    <div class="grid-auto">
                        <div>
                            <h5>COPY（推荐）</h5>
                            <div class="module-code-file" style="margin-top: 0.5rem;">
                                <div class="module-content">
                                    <pre><code># 复制单个文件
COPY index.html /usr/share/nginx/html/

# 复制整个目录
COPY ./app /app/

# 复制多个文件
COPY file1.txt file2.txt /app/</code></pre>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5>ADD（扩展功能）</h5>
                            <div class="module-code-file" style="margin-top: 0.5rem;">
                                <div class="module-content">
                                    <pre><code># 自动解压 tar 包
ADD archive.tar.gz /app/

# 从 URL 下载（不推荐）
ADD https://example.com/file.txt /app/</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p style="margin-top: 0.75rem; font-size: 0.875rem; color: var(--color-text-light);"><strong>建议：</strong>优先使用 COPY，更清晰简单。</p>
                </div>
            </div>

            <!-- WORKDIR -->
            <div class="module-concept" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-folder"></i>
                    <h4>WORKDIR：设置工作目录</h4>
                </div>
                <div class="module-content">
                    <p>设置后续指令的工作目录，类似 <code>cd</code> 命令。</p>
                    <div class="module-code-file" style="margin-top: 0.75rem;">
                        <div class="module-content">
                            <pre><code>FROM node:alpine

WORKDIR /app

# 后续 COPY、RUN 都在 /app 目录下
COPY package.json .
RUN npm install
COPY . .</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CMD & ENTRYPOINT -->
            <div class="module-concept" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-rocket"></i>
                    <h4>CMD & ENTRYPOINT：启动命令</h4>
                </div>
                <div class="module-content">
                    <div class="grid-auto">
                        <div>
                            <h5>CMD（推荐）</h5>
                            <p style="font-size: 0.875rem; margin-bottom: 0.5rem;">容器启动时执行的默认命令</p>
                            <div class="module-code-file">
                                <div class="module-content">
                                    <pre><code># JSON 数组格式（推荐）
CMD ["nginx", "-g", "daemon off;"]

# Shell 格式
CMD nginx -g "daemon off;"</code></pre>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5>ENTRYPOINT（固定入口）</h5>
                            <p style="font-size: 0.875rem; margin-bottom: 0.5rem;">不能被 <code>docker run</code> 覆盖</p>
                            <div class="module-code-file">
                                <div class="module-content">
                                    <pre><code>ENTRYPOINT ["python", "app.py"]

# docker run 时传入的参数会追加
# docker run myapp --port 8000
# 实际执行: python app.py --port 8000</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ENV & EXPOSE -->
            <div class="module-concept" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-cog"></i>
                    <h4>ENV 和 EXPOSE</h4>
                </div>
                <div class="module-content">
                    <div class="module-code-file">
                        <div class="module-content">
                            <pre><code>FROM nginx:alpine

# 设置环境变量
ENV APP_VERSION=1.0
ENV NODE_ENV=production

# 声明端口（文档作用）
EXPOSE 80 443

CMD ["nginx", "-g", "daemon off;"]</code></pre>
                        </div>
                    </div>
                    <p style="margin-top: 0.75rem; font-size: 0.875rem;"><strong>注意：</strong>EXPOSE 只是声明，实际端口映射仍需 <code>docker run -p</code>。</p>
                </div>
            </div>
        </section>

        <!-- Section 6: 实战项目 -->
        <section id="mini-project" class="section-card">
            <h2>
                <i class="fas fa-project-diagram" style="color: var(--color-accent); margin-right: 0.75rem;"></i>
                6. 完整项目实战：打包个人主页
            </h2>

            <div class="module-practice">
                <div class="module-header">
                    <i class="fas fa-target"></i>
                    <h4>项目目标</h4>
                </div>
                <div class="module-content">
                    <p>创建一个包含 HTML、CSS、图片的完整网站，用 Dockerfile 打包成镜像，一键部署。</p>
                </div>
            </div>

            <div class="module-steps" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-list-ol"></i>
                    <h4>实战步骤</h4>
                </div>
                <div class="module-content">
                    
                    <div class="step-item">
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <h5>创建项目结构</h5>
                            <div class="module-command">
                                <div class="module-content">
                                    <pre><code>mkdir -p ~/my-website/css ~/my-website/images
cd ~/my-website</code></pre>
                                </div>
                            </div>
                            <p style="margin-top: 0.5rem; font-size: 0.875rem;">项目结构：</p>
                            <div class="module-output">
                                <div class="module-content">
                                    <pre><code>my-website/
├── Dockerfile
├── index.html
├── css/
│   └── style.css
└── images/
    └── logo.png</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-item">
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <h5>创建 HTML 文件</h5>
                            <div class="module-code-file">
                                <div class="module-header">
                                    <i class="fas fa-file-code"></i>
                                    <h4>index.html</h4>
                                </div>
                                <div class="module-content">
                                    <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="zh-CN"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;我的 Docker 主页&lt;/title&gt;
    &lt;link rel="stylesheet" href="css/style.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;🚀 欢迎来到我的 Docker 主页！&lt;/h1&gt;
    &lt;p&gt;这个网站是用 Docker 构建和部署的&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-item">
                        <span class="step-number">3</span>
                        <div class="step-content">
                            <h5>创建 CSS 文件</h5>
                            <div class="module-code-file">
                                <div class="module-header">
                                    <i class="fas fa-file-code"></i>
                                    <h4>css/style.css</h4>
                                </div>
                                <div class="module-content">
                                    <pre><code>body {
    font-family: -apple-system, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    text-align: center;
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-item">
                        <span class="step-number">4</span>
                        <div class="step-content">
                            <h5>编写 Dockerfile</h5>
                            <div class="module-code-file">
                                <div class="module-header">
                                    <i class="fas fa-file-code"></i>
                                    <h4>Dockerfile</h4>
                                </div>
                                <div class="module-content">
                                    <pre><code>FROM nginx:alpine

# 复制所有文件到 nginx 默认目录
COPY . /usr/share/nginx/html/

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="step-item">
                        <span class="step-number">5</span>
                        <div class="step-content">
                            <h5>构建并运行</h5>
                            <div class="module-command">
                                <div class="module-content">
                                    <pre><code># 构建镜像
docker build -t my-website:v1 .

# 运行容器
docker run -d -p 8080:80 --name my-site my-website:v1</code></pre>
                                </div>
                            </div>
                            <p style="margin-top: 0.5rem;">访问 <code>http://localhost:8080</code> 查看效果！</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7: 镜像优化 -->
        <section id="image-optimize" class="section-card">
            <h2>
                <i class="fas fa-rocket" style="color: var(--color-success); margin-right: 0.75rem;"></i>
                7. 镜像优化技巧
            </h2>

            <div class="module-tip">
                <div class="module-header">
                    <i class="fas fa-compress"></i>
                    <h4>技巧 1：合并 RUN 指令</h4>
                </div>
                <div class="module-content">
                    <p>每个 RUN 都会创建一层，合并可以减少层数。</p>
                    <div class="grid-auto" style="margin-top: 0.75rem;">
                        <div>
                            <h5 style="color: var(--color-error);">❌ 不好的写法</h5>
                            <div class="module-code-file">
                                <div class="module-content">
                                    <pre><code>FROM ubuntu:20.04
RUN apt-get update
RUN apt-get install -y curl
RUN apt-get install -y vim</code></pre>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5 style="color: var(--color-success);">✅ 优化后</h5>
                            <div class="module-code-file">
                                <div class="module-content">
                                    <pre><code>FROM ubuntu:20.04
RUN apt-get update && \
    apt-get install -y curl vim && \
    rm -rf /var/lib/apt/lists/*</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-tip" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-weight"></i>
                    <h4>技巧 2：使用 Alpine 镜像</h4>
                </div>
                <div class="module-content">
                    <p>Alpine 是超轻量级 Linux 发行版，基础镜像只有 5MB！</p>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 0.75rem;">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--color-border);">
                                <th style="text-align: left; padding: 0.5rem;">镜像</th>
                                <th style="text-align: right; padding: 0.5rem;">大小</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid var(--color-border);">
                                <td style="padding: 0.5rem;"><code>ubuntu:20.04</code></td>
                                <td style="text-align: right; padding: 0.5rem; color: var(--color-error);">72 MB</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--color-border);">
                                <td style="padding: 0.5rem;"><code>nginx:latest</code></td>
                                <td style="text-align: right; padding: 0.5rem; color: var(--color-warning);">141 MB</td>
                            </tr>
                            <tr style="background-color: #dcfce7;">
                                <td style="padding: 0.5rem;"><code><strong>nginx:alpine</strong></code></td>
                                <td style="text-align: right; padding: 0.5rem; color: var(--color-success); font-weight: 700;">23 MB ✨</td>
                            </tr>
                        </tbody>
                    </table>
                    <p style="margin-top: 0.75rem; font-size: 0.875rem;">节省了 <strong>84%</strong> 的空间！</p>
                </div>
            </div>

            <div class="module-tip" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-layer-group"></i>
                    <h4>技巧 3：多阶段构建（进阶）</h4>
                </div>
                <div class="module-content">
                    <p>编译型语言可以分成"构建阶段"和"运行阶段"，最终镜像只包含运行所需的文件。</p>
                    <div class="module-code-file" style="margin-top: 0.75rem;">
                        <div class="module-header">
                            <i class="fas fa-file-code"></i>
                            <h4>Go 应用示例</h4>
                        </div>
                        <div class="module-content">
                            <pre><code># 阶段 1: 构建
FROM golang:1.20 AS builder
WORKDIR /app
COPY . .
RUN go build -o myapp

# 阶段 2: 运行（最终镜像）
FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/myapp .
CMD ["./myapp"]</code></pre>
                        </div>
                    </div>
                    <p style="margin-top: 0.75rem; font-size: 0.875rem;"><strong>效果：</strong>构建阶段 800MB → 最终镜像仅 10MB！</p>
                </div>
            </div>
        </section>

        <!-- Section 8: 常见错误 -->
        <section id="troubleshooting" class="section-card">
            <h2>
                <i class="fas fa-bug" style="color: var(--color-error); margin-right: 0.75rem;"></i>
                8. 常见错误排查
            </h2>

            <div class="module-warning">
                <div class="module-header">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h4>错误 1：CMD 写多个，只执行最后一个</h4>
                </div>
                <div class="module-content">
                    <div class="grid-auto">
                        <div>
                            <h5 style="color: var(--color-error);">❌ 错误</h5>
                            <div class="module-code-file">
                                <div class="module-content">
                                    <pre><code>FROM nginx:alpine
CMD ["echo", "Hello"]
CMD ["nginx", "-g", "daemon off;"]</code></pre>
                                </div>
                            </div>
                            <p style="font-size: 0.875rem; margin-top: 0.5rem;">问题：只会执行最后一个 CMD</p>
                        </div>
                        <div>
                            <h5 style="color: var(--color-success);">✅ 正确</h5>
                            <div class="module-code-file">
                                <div class="module-content">
                                    <pre><code>FROM nginx:alpine
# 构建时执行
RUN echo "Hello"
# 启动时执行
CMD ["nginx", "-g", "daemon off;"]</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-warning" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-folder-open"></i>
                    <h4>错误 2：COPY 找不到文件</h4>
                </div>
                <div class="module-content">
                    <p style="margin-bottom: 0.75rem;"><strong>常见问题：</strong>COPY 不能访问 Dockerfile 所在目录的父目录。</p>
                    <div class="module-code-file">
                        <div class="module-content">
                            <pre><code># ❌ 错误：不能访问父目录
COPY ../config.json /app/

# ✅ 正确：使用相对路径
COPY ./config/app.json /app/
COPY *.html /usr/share/nginx/html/</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-warning" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-network-wired"></i>
                    <h4>错误 3：浏览器访问不了</h4>
                </div>
                <div class="module-content">
                    <p style="margin-bottom: 0.5rem;"><strong>排查步骤：</strong></p>
                    <ol style="font-size: 0.875rem;">
                        <li>检查容器是否在运行：<code>docker ps</code></li>
                        <li>检查端口映射是否正确：<code>docker port 容器名</code></li>
                        <li>查看容器日志：<code>docker logs 容器名</code></li>
                        <li>确认防火墙没有阻止端口</li>
                    </ol>
                </div>
            </div>
        </section>

        <!-- Summary -->
        <section class="section-card">
            <div class="module-summary">
                <div class="module-header">
                    <i class="fas fa-bookmark"></i>
                    <h4>本讲总结</h4>
                </div>
                <div class="module-content">
                    <ul>
                        <li><strong>Dockerfile</strong> 是镜像的"施工图纸"，实现自动化构建</li>
                        <li>核心指令：<code>FROM</code>、<code>RUN</code>、<code>COPY</code>、<code>WORKDIR</code>、<code>CMD</code></li>
                        <li>优化技巧：合并 RUN、使用 Alpine、多阶段构建</li>
                        <li>调试方法：查看日志、进入容器、检查端口</li>
                    </ul>
                </div>
            </div>

            <div class="module-practice" style="margin-top: 1.5rem;">
                <div class="module-header">
                    <i class="fas fa-tasks"></i>
                    <h4>课后作业</h4>
                </div>
                <div class="module-content">
                    <div class="practice-task">
                        <h5>作业 1：基础练习</h5>
                        <p>创建一个 Python Flask 应用的 Dockerfile，要求：</p>
                        <ul style="font-size: 0.875rem;">
                            <li>使用 <code>python:3.9-alpine</code> 基础镜像</li>
                            <li>复制 <code>requirements.txt</code> 并安装依赖</li>
                            <li>复制应用代码到 <code>/app</code></li>
                            <li>暴露 5000 端口</li>
                            <li>启动命令：<code>python app.py</code></li>
                        </ul>
                    </div>
                    <div class="practice-task">
                        <h5>作业 2：优化挑战</h5>
                        <p>对比以下两种写法的镜像大小，记录结果并分析原因。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Next Lecture -->
        <div class="section-card" style="text-align: center; background-color: var(--color-subtle);">
            <h3 style="margin-bottom: 1rem;">
                <i class="fas fa-forward" style="color: var(--color-accent); margin-right: 0.5rem;"></i>
                下节课预告
            </h3>
            <p style="margin-bottom: 0.5rem;"><strong>第四讲：Docker Compose 多容器编排</strong></p>
            <ul style="text-align: left; max-width: 600px; margin: 1rem auto; color: var(--color-text-light);">
                <li>什么是 Docker Compose？</li>
                <li>用 YAML 文件管理多个容器</li>
                <li>实战：搭建 Web 应用 + 数据库</li>
                <li>容器间网络通信</li>
            </ul>
        </div>

    </main>

    <!-- Footer -->
    <footer style="background-color: var(--color-text); color: var(--color-text-lighter); padding: 2rem 0; margin-top: 3rem; border-top: 1px solid var(--color-border);">
        <div class="container text-center">
            <p style="font-size: 0.875rem;">Docker 容器技术竞赛培训 - 第三讲：Dockerfile 自动化构建镜像</p>
            <p style="margin-top: 0.5rem; font-size: 0.75rem; opacity: 0.7;">
                <i class="fas fa-cube" style="margin-right: 0.25rem;"></i> 镜像自动化 • 
                <i class="fas fa-code" style="margin: 0 0.25rem;"></i> Dockerfile 实战 • 
                <i class="fas fa-rocket" style="margin: 0 0.25rem;"></i> 镜像优化
            </p>
        </div>
    </footer>

    <script src="scripts/main.js" defer></script>
</body>
</html>
